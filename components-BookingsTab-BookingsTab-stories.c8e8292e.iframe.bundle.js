"use strict";(self.webpackChunkbook_it_coworking_frontend=self.webpackChunkbook_it_coworking_frontend||[]).push([[3350],{"./src/components/BookingsTab/BookingsTab.stories.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BookingsTabDemo:function(){return BookingsTabDemo},__namedExportsOrder:function(){return __namedExportsOrder},default:function(){return BookingsTab_stories}});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),BookingsCard=__webpack_require__("./src/components/BookingsCard/BookingsCard.jsx"),Api=__webpack_require__("./src/utils/Api.jsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),BookingsTab_BookingsTab=function BookingsTab(){var _useState=(0,react.useState)("active"),_useState2=(0,slicedToArray.Z)(_useState,2),activeTab=_useState2[0],setActiveTab=_useState2[1],_useState3=(0,react.useState)([]),_useState4=(0,slicedToArray.Z)(_useState3,2),bookings=_useState4[0],setBookings=_useState4[1];return(0,react.useEffect)((function(){"active"===activeTab?(0,Api.zB)().then((function(data){var modData=data.map((function(item){return(0,objectSpread2.Z)((0,objectSpread2.Z)({},item),{},{isFinished:!1})}));setBookings(modData)})).catch((function(){})):"finished"===activeTab&&(0,Api.pz)().then((function(data){var modData=data.map((function(item){return(0,objectSpread2.Z)((0,objectSpread2.Z)({},item),{},{isFinished:!0})}));setBookings(modData)})).catch((function(){}))}),[activeTab]),(0,jsx_runtime.jsxs)("section",{className:"bookings",children:[(0,jsx_runtime.jsx)("h2",{className:"bookings__title",children:"Бронирования"}),(0,jsx_runtime.jsxs)("div",{className:"bookings__tabs",children:[(0,jsx_runtime.jsx)("button",{className:"bookings__tab-button ".concat("active"===activeTab?"bookings__tab-button_active":""),onClick:function onClick(){return setActiveTab("active")},children:"Активные"}),(0,jsx_runtime.jsx)("button",{className:"bookings__tab-button ".concat("finished"===activeTab?"bookings__tab-button_active":""),onClick:function onClick(){return setActiveTab("finished")},children:"Завершенные"})]}),(0,jsx_runtime.jsxs)("ul",{className:"bookings__card-list",children:[0===bookings.length&&(0,jsx_runtime.jsx)("span",{className:"bookings__nodata",children:"Пока бронирований нет"}),bookings.map((function(item){return(0,jsx_runtime.jsx)(BookingsCard.t,{item:item},item.id)}))]})]})};BookingsTab_BookingsTab.__docgenInfo={description:"",methods:[],displayName:"BookingsTab"};var _BookingsTabDemo$para,_BookingsTabDemo$para2,_BookingsTabDemo$para3,dummy_spot2=__webpack_require__("./src/images/dummy-spot2.jpg"),BookingsTab_stories={title:"Pages/Profile/Tabs/BookingsTab",component:BookingsTab_BookingsTab,tags:["autodocs"],parameters:{layout:"centered"}},BookingsTabDemo={args:{bookings:[{id:"1",spot:{name:"Парк",image:dummy_spot2},date:"6 сентября 2023",start_time:"12:00",end_time:"13:00",bill:200,isFinished:!1,status:"Confirmed"},{id:"2",spot:{name:"У моря",image:dummy_spot2},date:"7 сентября 2023",start_time:"12:00",end_time:"13:00",bill:200,isFinished:!1,status:"Processing"},{id:"3",spot:{name:"Особняк",image:dummy_spot2},date:"8 сентября 2023",start_time:"08:00",end_time:"10:00",bill:200,isFinished:!0}]}};BookingsTabDemo.parameters=(0,objectSpread2.Z)((0,objectSpread2.Z)({},BookingsTabDemo.parameters),{},{docs:(0,objectSpread2.Z)((0,objectSpread2.Z)({},null===(_BookingsTabDemo$para=BookingsTabDemo.parameters)||void 0===_BookingsTabDemo$para?void 0:_BookingsTabDemo$para.docs),{},{source:(0,objectSpread2.Z)({originalSource:'{\n  args: {\n    bookings: [{\n      id: "1",\n      spot: {\n        name: "Парк",\n        image: SpotPhoto\n      },\n      date: "6 сентября 2023",\n      start_time: "12:00",\n      end_time: "13:00",\n      bill: 200,\n      isFinished: false,\n      status: "Confirmed"\n    }, {\n      id: "2",\n      spot: {\n        name: "У моря",\n        image: SpotPhoto\n      },\n      date: "7 сентября 2023",\n      start_time: "12:00",\n      end_time: "13:00",\n      bill: 200,\n      isFinished: false,\n      status: "Processing"\n    }, {\n      id: "3",\n      spot: {\n        name: "Особняк",\n        image: SpotPhoto\n      },\n      date: "8 сентября 2023",\n      start_time: "08:00",\n      end_time: "10:00",\n      bill: 200,\n      isFinished: true\n    }]\n  }\n}'},null===(_BookingsTabDemo$para2=BookingsTabDemo.parameters)||void 0===_BookingsTabDemo$para2||null===(_BookingsTabDemo$para3=_BookingsTabDemo$para2.docs)||void 0===_BookingsTabDemo$para3?void 0:_BookingsTabDemo$para3.source)})});var __namedExportsOrder=["BookingsTabDemo"]},"./src/components/BookingsCard/BookingsCard.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{t:function(){return BookingsCard_BookingsCard}});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),constants=__webpack_require__("./src/utils/constants.jsx"),Api=__webpack_require__("./src/utils/Api.jsx"),utils=__webpack_require__("./src/utils/utils.js"),dist=__webpack_require__("./node_modules/react-router/dist/index.js"),useApiError=__webpack_require__("./src/hooks/useApiError.js");var ReviewsForm=__webpack_require__("./src/components/Forms/ReviewsForm/ReviewsForm.jsx"),Button=__webpack_require__("./src/components/UI-kit/Button/Button.jsx"),Popup=__webpack_require__("./src/components/Popup/Popup.jsx");__webpack_require__("./src/components/UI-kit/StarRating/StarRating.jsx");var time=__webpack_require__.p+"static/media/time.b900fce9bae5f45c3b154568a1de1f2a.svg";var _statusLabels,card=__webpack_require__.p+"static/media/card.55cc540fde5cfb4d7fe66cea9e1d1b96.svg",jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),getStatusLabel=function getStatusLabel(status,className){return(0,jsx_runtime.jsx)("span",{className:"bookings-card__status bookings-card__status_".concat(className),children:status})},statusLabels=(_statusLabels={},(0,defineProperty.Z)(_statusLabels,constants.rq.WAIT_PAY,getStatusLabel(constants.rq.WAIT_PAY,"warn")),(0,defineProperty.Z)(_statusLabels,constants.rq.PAID,getStatusLabel(constants.rq.PAID,"success")),(0,defineProperty.Z)(_statusLabels,constants.rq.FINISH,getStatusLabel(constants.rq.FINISH,"main")),(0,defineProperty.Z)(_statusLabels,constants.rq.CANCEL,getStatusLabel(constants.rq.CANCEL,"alert")),(0,defineProperty.Z)(_statusLabels,constants.rq.NOT_PAID,getStatusLabel(constants.rq.NOT_PAID,"warn")),_statusLabels),BookingsCard_BookingsCard=function BookingsCard(_ref){var item=_ref.item,_usePopupOpen=function usePopupOpen(){var _location$state,location=(0,dist.TH)(),clearApiError=(0,useApiError.Z)().clearApiError,_React$useState=react.useState(!1),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),isOpenPopup=_React$useState2[0],setIsOpenPopup=_React$useState2[1],_React$useState3=react.useState(null==location||null===(_location$state=location.state)||void 0===_location$state?void 0:_location$state.previousLocation),_React$useState4=(0,slicedToArray.Z)(_React$useState3,2),previousLocation=_React$useState4[0],setPreviousLocation=_React$useState4[1],showPopup=(0,utils.p9)(constants.Xd,location),handleClosePopup=react.useCallback((function(){setIsOpenPopup(!1),showPopup&&(clearApiError(),setPreviousLocation(null),window.history.replaceState(null,null,"/"))}),[clearApiError,showPopup]);return react.useEffect((function(){function closeByEscape(evt){"Escape"===evt.key&&handleClosePopup()}function closeByOverlayClick(evt){(evt.target.classList.contains("popup")||evt.target.classList.contains("button_type_close"))&&handleClosePopup()}return isOpenPopup&&(document.addEventListener("keydown",closeByEscape),document.addEventListener("click",closeByOverlayClick)),function(){document.removeEventListener("keydown",closeByEscape),document.removeEventListener("click",closeByOverlayClick)}}),[isOpenPopup,handleClosePopup]),{isOpenPopup:isOpenPopup,handleOpenPopup:function handleOpenPopup(){setIsOpenPopup(!0),setPreviousLocation(location)},handleClosePopup:handleClosePopup,previousLocation:previousLocation}}(),isOpenPopup=_usePopupOpen.isOpenPopup,handleOpenPopup=_usePopupOpen.handleOpenPopup,handleClosePopup=_usePopupOpen.handleClosePopup,_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),isCancellationConfirmed=_useState2[0],setIsCancellationConfirmed=_useState2[1],_useState3=(0,react.useState)(!1),_useState4=(0,slicedToArray.Z)(_useState3,2),isReviewFormOpen=_useState4[0],setIsReviewFormOpen=_useState4[1],_useState5=(0,react.useState)(null),_useState6=(0,slicedToArray.Z)(_useState5,2),serverError=_useState6[0],setServerError=_useState6[1];console.log(item.reviews);var content,handleCloseBookingPopup=function handleCloseBookingPopup(){handleClosePopup(),setIsCancellationConfirmed(!1),setIsReviewFormOpen(!1),setServerError(null)},handleOpenReviewForm=function handleOpenReviewForm(){setIsReviewFormOpen(!0),handleOpenPopup()};return content=isCancellationConfirmed?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("p",{className:"bookings-card__popup-text bookings-card__popup-text_type_long",children:["Бронирование «",item.location_name.toUpperCase()," с ",item.start_time," ","до ",item.end_time,"» отменено.",(0,jsx_runtime.jsx)("br",{})," Мы отправим вам подтверждение на почту и вернем предоплату."]}),(0,jsx_runtime.jsx)("p",{className:"bookings-card__popup-text",children:"Хотите создать бронирование на другую дату?"}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__button-container",children:[(0,jsx_runtime.jsx)(Button.Z,{btnText:"Назад",btnClass:"button__profile-transparent",onClick:handleCloseBookingPopup}),(0,jsx_runtime.jsx)(Button.Z,{btnText:"Создать",btnClass:"button__profile-edit",onClick:handleOpenReviewForm})]})]}):isReviewFormOpen?(0,jsx_runtime.jsx)(ReviewsForm.Z,{onSubmit:function handleReviewSubmit(data){setServerError(null),(0,Api.zU)(item.location_id,item.spot,item.id,data).then((function(){return handleClosePopup()})).catch((function(e){console.log(e.booked_spot[0]),setServerError(e.booked_spot[0])})).finally((function(){}))},serverError:serverError}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("p",{className:"bookings-card__popup-text",children:[function getPopupText(booking){return booking.status===constants.rq.PAID?"Бронирование уже оплачено.":booking.status===constants.rq.WAIT_PAY||constants.rq.NOT_PAID?"Бронирование еще находится в обработке.":"Отменить бронирование"}(item),(0,jsx_runtime.jsx)("br",{}),"Вы уверены, что хотите отменить его?"]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__button-container",children:[(0,jsx_runtime.jsx)(Button.Z,{btnText:"Назад",btnClass:"button__profile-transparent",onClick:handleCloseBookingPopup}),(0,jsx_runtime.jsx)(Button.Z,{btnText:"Отменить",btnClass:"button__profile-edit",onClick:function handleConfirmCancellation(){(0,Api.sl)(item.location_id,item.spot,item.id).finally((function(){setIsCancellationConfirmed(!0)}))}})]})]}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("li",{className:"bookings-card",children:[(0,jsx_runtime.jsx)("img",{className:"bookings-card__image",src:null==item?void 0:item.location_photo,alt:item.location_name}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__text-container",children:[(0,jsx_runtime.jsx)("h3",{className:"bookings-card__name",children:item.location_name}),(0,jsx_runtime.jsx)("div",{className:"bookings-card__status",children:statusLabels[item.status]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__date-row",children:[(0,jsx_runtime.jsx)("img",{src:time,alt:"Иконка часов"}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__date-container",children:[(0,jsx_runtime.jsx)("p",{className:"bookings-card__date",children:(0,utils.p6)(item.date)}),(0,jsx_runtime.jsxs)("p",{className:"bookings-card__date",children:[item.start_time,"-",item.end_time]})]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__price-container",children:[(0,jsx_runtime.jsx)("img",{src:card,alt:"Иконка платежной карты"}),(0,jsx_runtime.jsxs)("span",{className:"bookings-card__price",children:[item.bill," ₽"]})]})]}),item.isFinished?(0,jsx_runtime.jsx)(Button.Z,{btnText:null===item.reviews?"Оставить отзыв":"Отзыв оставлен",btnClass:"button__profile-bookings",onClick:handleOpenReviewForm,isValidBtn:null===item.reviews}):(0,jsx_runtime.jsx)(Button.Z,{btnText:"Отменить",btnClass:"button__profile-bookings",onClick:handleOpenPopup})]})]},item.id),(0,jsx_runtime.jsx)(Popup.Z,{isOpen:isOpenPopup,popupClass:"bookings-card__popup",onClickClose:handleCloseBookingPopup,children:content})]})};BookingsCard_BookingsCard.defaultProps={item:prop_types_default().shape({})},BookingsCard_BookingsCard.__docgenInfo={description:"",methods:[],displayName:"BookingsCard",props:{item:{defaultValue:{value:"PropTypes.shape({})",computed:!0},description:"",type:{name:"shape",value:{id:{name:"number",required:!1},location_photo:{name:"string",required:!1},location_name:{name:"string",required:!1},location_id:{name:"number",required:!1},spot:{name:"number",required:!1},date:{name:"string",required:!1},start_time:{name:"string",required:!1},end_time:{name:"string",required:!1},bill:{name:"string",required:!1},isFinished:{name:"bool",required:!1},reviews:{name:"number",required:!1},status:{name:"enum",value:[{value:"ORDER_STATUSES.WAIT_PAY",computed:!0},{value:"ORDER_STATUSES.PAID",computed:!0},{value:"ORDER_STATUSES.FINISH",computed:!0},{value:"ORDER_STATUSES.CANCEL",computed:!0},{value:"ORDER_STATUSES.NOT_PAID",computed:!0}],required:!1}}},required:!1}}}},"./src/utils/utils.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{CN:function(){return formatPhone},nD:function(){return generateCenterFromPoints},p6:function(){return formatDate},p9:function(){return checkPath},vX:function(){return formatEventDate}});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/utils/constants.jsx");function formatEventDate(date){var dateComponents=date.split("-"),year=dateComponents[0].slice(2),month=dateComponents[1],day=dateComponents[2];return"".concat(month,"/").concat(day,"/").concat(year)}var generateCenterFromPoints=function generateCenterFromPoints(points){if(0===points.length)return[_constants__WEBPACK_IMPORTED_MODULE_0__.mV,_constants__WEBPACK_IMPORTED_MODULE_0__.H6];var totalLat=points.reduce((function(sum,point){return sum+point.coordinates[0]}),0),totalLng=points.reduce((function(sum,point){return sum+point.coordinates[1]}),0);return[totalLat/points.length,totalLng/points.length]},checkPath=function checkPath(el,location){return el.includes(location.pathname)};function formatPhone(phoneNumber){return phoneNumber.replace(/\D/g,"").replace(/(\d{1})(\d{3})(\d{3})(\d{2})(\d{2})/,"+$1 $2 $3 $4 $5")}function formatDate(dateString){return new Date(dateString).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}).replace(/ г\.$/,"")}},"./src/images/dummy-spot2.jpg":function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"04ff475c35a85ed7a793.jpg"}}]);
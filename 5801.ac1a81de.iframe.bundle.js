"use strict";(self.webpackChunkbook_it_coworking_frontend=self.webpackChunkbook_it_coworking_frontend||[]).push([[5801],{"./src/components/BookingsCard/BookingsCard.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{t:function(){return BookingsCard_BookingsCard}});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),dist=__webpack_require__("./node_modules/react-router/dist/index.js"),react_router_dom_dist=__webpack_require__("./node_modules/react-router-dom/dist/index.js"),currentUserContext=__webpack_require__("./src/contexts/currentUserContext.js"),constants=__webpack_require__("./src/utils/constants.jsx"),Api=__webpack_require__("./src/utils/Api.jsx"),utils=__webpack_require__("./src/utils/utils.js"),usePopupOpen=__webpack_require__("./src/hooks/usePopupOpen.js"),ReviewsForm=__webpack_require__("./src/components/Forms/ReviewsForm/ReviewsForm.jsx"),Button=__webpack_require__("./src/components/UI-kit/Button/Button.jsx"),Popup=__webpack_require__("./src/components/Popup/Popup.jsx");var time=__webpack_require__.p+"static/media/time.b900fce9bae5f45c3b154568a1de1f2a.svg";var _statusLabels,card=__webpack_require__.p+"static/media/card.55cc540fde5cfb4d7fe66cea9e1d1b96.svg",jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),getStatusLabel=function getStatusLabel(status,className){return(0,jsx_runtime.jsx)("span",{className:"bookings-card__status bookings-card__status_".concat(className),children:status})},statusLabels=(_statusLabels={},(0,defineProperty.Z)(_statusLabels,constants.rq.WAIT_PAY,getStatusLabel(constants.rq.WAIT_PAY,"warn")),(0,defineProperty.Z)(_statusLabels,constants.rq.PAID,getStatusLabel(constants.rq.PAID,"success")),(0,defineProperty.Z)(_statusLabels,constants.rq.FINISH,getStatusLabel(constants.rq.FINISH,"main")),(0,defineProperty.Z)(_statusLabels,constants.rq.CANCEL,getStatusLabel(constants.rq.CANCEL,"alert")),(0,defineProperty.Z)(_statusLabels,constants.rq.NOT_PAID,getStatusLabel(constants.rq.NOT_PAID,"warn")),_statusLabels),BookingsCard_BookingsCard=function BookingsCard(_ref){var content,item=_ref.item,onUpdateStatus=_ref.onUpdateStatus,onReviewSubmit=_ref.onReviewSubmit,_usePopupOpen=(0,usePopupOpen.Z)(),isOpenPopup=_usePopupOpen.isOpenPopup,handleOpenPopup=_usePopupOpen.handleOpenPopup,handleClosePopup=_usePopupOpen.handleClosePopup,_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),isCancellationConfirmed=_useState2[0],setIsCancellationConfirmed=_useState2[1],_useState3=(0,react.useState)(!1),_useState4=(0,slicedToArray.Z)(_useState3,2),isReviewFormOpen=_useState4[0],setIsReviewFormOpen=_useState4[1],_useState5=(0,react.useState)(null),_useState6=(0,slicedToArray.Z)(_useState5,2),serverError=_useState6[0],setServerError=_useState6[1],showMessage=(0,react.useContext)(currentUserContext.E).showMessage,navigate=(0,dist.s0)(),handleCloseBookingPopup=function handleCloseBookingPopup(){handleClosePopup(),setIsCancellationConfirmed(!1),setIsReviewFormOpen(!1),setServerError(null)},handleOpenReviewForm=function handleOpenReviewForm(){setIsReviewFormOpen(!0),handleOpenPopup()};return content=isCancellationConfirmed?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("p",{className:"bookings-card__popup-text",children:["Бронирование «",item.location_name.toUpperCase()," с ",item.start_time," ","до ",item.end_time,"» отменено. Мы отправим вам подтверждение на почту и вернем предоплату."]}),(0,jsx_runtime.jsx)("p",{className:"bookings-card__popup-text",children:"Хотите создать бронирование на другую дату?"}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__button-container",children:[(0,jsx_runtime.jsx)(Button.Z,{btnText:"Нет",btnType:"button",btnClass:"button__profile-transparent button_type_cancel",onClick:function onClick(){handleCloseBookingPopup(),onUpdateStatus(item.id)}}),(0,jsx_runtime.jsx)(react_router_dom_dist.rU,{to:"/points/".concat(item.location_id),children:(0,jsx_runtime.jsx)(Button.Z,{btnText:"Создать",btnType:"button",btnClass:"button__profile-edit button_type_createorder",onClick:handleOpenReviewForm})})]})]}):isReviewFormOpen?(0,jsx_runtime.jsx)(ReviewsForm.Z,{onSubmit:function handleReviewSubmit(data){setServerError(null),(0,Api.zU)(item.location_id,item.spot,item.id,data).then((function(){handleClosePopup(),onReviewSubmit(item.id),showMessage(constants.Ue,"info")})).catch((function(e){setServerError(e.booked_spot[0])})).finally((function(){}))},serverError:serverError}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("p",{className:"bookings-card__popup-text",children:[(0,utils.cJ)(item),(0,jsx_runtime.jsx)("br",{}),"Вы уверены, что хотите отменить его?"]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__button-container",children:[(0,jsx_runtime.jsx)(Button.Z,{btnText:"Назад",btnClass:"button__profile-transparent button_type_cancel",onClick:handleCloseBookingPopup}),(0,jsx_runtime.jsx)(Button.Z,{btnText:"Да, Отменить",btnClass:"button__profile-edit button_type_order",onClick:function handleConfirmCancellation(){(0,Api.sl)(item.location_id,item.spot,item.id).then((function(){setIsCancellationConfirmed(!0)})).catch((function(){return showMessage(constants.SJ)})).finally((function(){}))}})]})]}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("li",{className:"bookings-card",children:[(0,jsx_runtime.jsx)("img",{className:"bookings-card__image",src:null==item?void 0:item.location_photo,alt:item.location_name}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__text-container",children:[(0,jsx_runtime.jsx)("h3",{className:"bookings-card__name",children:item.location_name}),(0,jsx_runtime.jsx)("div",{className:"bookings-card__status",children:statusLabels[item.status]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__date-row",children:[(0,jsx_runtime.jsx)("img",{src:time,alt:"Иконка часов"}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__date-container",children:[(0,jsx_runtime.jsx)("p",{className:"bookings-card__date",children:(0,utils.p6)(item.date)}),(0,jsx_runtime.jsxs)("p",{className:"bookings-card__date",children:[item.start_time,"-",item.end_time]})]}),(0,jsx_runtime.jsxs)("div",{className:"bookings-card__price-container",children:[(0,jsx_runtime.jsx)("img",{src:card,alt:"Иконка платежной карты"}),(0,jsx_runtime.jsxs)("span",{className:"bookings-card__price",children:[item.bill," ₽"]})]})]}),item.isFinished?(0,jsx_runtime.jsx)(Button.Z,{btnText:null===item.reviews?"Оставить отзыв":"Отзыв оставлен",btnClass:"button_width-bookings button_type_sendreview",onClick:handleOpenReviewForm,isValidBtn:null===item.reviews&&function shouldButtonBeDisabled(){return item.status!==constants.rq.CANCEL}()}):(0,jsx_runtime.jsx)(Button.Z,{btnText:item.status!==constants.rq.WAIT_PAY?"Отменить":"Оплатить",btnClass:item.status!==constants.rq.WAIT_PAY?"button__profile-small button_type_transparent button_width-bookings":"button__profile-small button_type_order button_width-bookings",onClick:function onClick(){return function handleCardAction(status){status===constants.rq.WAIT_PAY?navigate("/payments",{state:{id:item.location_id,spotId:item.spot,name:item.location_name,location:item.location_id,date:item.date,startTime:item.start_time,endTime:item.end_time,bill:item.bill,orderId:item.id}}):handleOpenPopup()}(item.status)}})]})]},item.id),(0,jsx_runtime.jsx)(Popup.Z,{isOpen:isOpenPopup,popupClass:"bookings-card__popup popup_type_whitemobile",onClickClose:function onClickClose(){handleCloseBookingPopup(),isCancellationConfirmed&&onUpdateStatus(item.id)},children:content})]})};BookingsCard_BookingsCard.defaultProps={item:prop_types_default().shape({}),onUpdateStatus:void 0,onReviewSubmit:void 0},BookingsCard_BookingsCard.__docgenInfo={description:"",methods:[],displayName:"BookingsCard",props:{item:{defaultValue:{value:"PropTypes.shape({})",computed:!0},description:"",type:{name:"shape",value:{id:{name:"number",required:!1},location_photo:{name:"string",required:!1},location_name:{name:"string",required:!1},location_id:{name:"number",required:!1},spot:{name:"number",required:!1},date:{name:"string",required:!1},start_time:{name:"string",required:!1},end_time:{name:"string",required:!1},bill:{name:"number",required:!1},isFinished:{name:"bool",required:!1},reviews:{name:"number",required:!1},status:{name:"enum",value:[{value:"ORDER_STATUSES.WAIT_PAY",computed:!0},{value:"ORDER_STATUSES.PAID",computed:!0},{value:"ORDER_STATUSES.FINISH",computed:!0},{value:"ORDER_STATUSES.CANCEL",computed:!0},{value:"ORDER_STATUSES.NOT_PAID",computed:!0}],required:!1}}},required:!1},onUpdateStatus:{defaultValue:{value:"undefined",computed:!0},description:"",type:{name:"func"},required:!1},onReviewSubmit:{defaultValue:{value:"undefined",computed:!0},description:"",type:{name:"func"},required:!1}}}},"./src/components/Forms/ReviewsForm/ReviewsForm.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return Forms_ReviewsForm_ReviewsForm}});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),Button=__webpack_require__("./src/components/UI-kit/Button/Button.jsx"),StarRating=__webpack_require__("./src/components/UI-kit/StarRating/StarRating.jsx"),constants=__webpack_require__("./src/utils/constants.jsx"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),ReviewsForm_ReviewsForm=function ReviewsForm(_ref){var onSubmit=_ref.onSubmit,serverError=_ref.serverError,_React$useState=react.useState(0),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),rating=_React$useState2[0],setRating=_React$useState2[1],_React$useState3=react.useState(""),_React$useState4=(0,slicedToArray.Z)(_React$useState3,2),reviewText=_React$useState4[0],setReviewText=_React$useState4[1],_React$useState5=react.useState(""),_React$useState6=(0,slicedToArray.Z)(_React$useState5,2),inputError=_React$useState6[0],setInputError=_React$useState6[1];return(0,jsx_runtime.jsxs)("div",{className:"reviews-form__popup-content",children:[(0,jsx_runtime.jsx)("p",{className:"reviews-form__popup-text reviews-form__popup-text_type_review",children:"Поставьте оценку и оставьте отзыв"}),(0,jsx_runtime.jsx)("section",{className:"reviews-form__container","aria-label":"форма отзывов",children:(0,jsx_runtime.jsxs)("div",{className:" ",children:[(0,jsx_runtime.jsx)(StarRating.Z,{rating:rating,onRatingChange:setRating}),(0,jsx_runtime.jsx)("form",{className:"",name:"form",autoComplete:"off",noValidate:!0,children:(0,jsx_runtime.jsxs)("fieldset",{className:"reviews-form__fieldset",children:[(0,jsx_runtime.jsx)("textarea",{className:"reviews-form__reviews ".concat(inputError?"reviews-form__reviews-error":""),rows:"10",cols:"45",name:"reviews",autoComplete:"off",placeholder:"Ваш текст...",value:reviewText,minLength:"10",maxLength:constants.HM,onChange:function onChange(evt){var text=evt.target.value;setInputError(evt.target.validationMessage),setReviewText(text)},required:!0}),inputError?(0,jsx_runtime.jsx)("span",{className:"reviews-form__box_text reviews-form__box_error",children:inputError}):(0,jsx_runtime.jsx)("span",{className:"reviews-form__box_text",children:"".concat(reviewText.length,"/").concat(constants.HM)})," ",serverError&&(0,jsx_runtime.jsx)("span",{className:"reviews-form__server-error",children:serverError}),(0,jsx_runtime.jsx)(Button.Z,{btnClass:"button__profile-review",btnType:"button",btnText:"Отправить",onClick:function handleReviewSubmit(e){e.preventDefault(),onSubmit({description:reviewText,rating:rating}),setReviewText(""),setRating(0)},isValidBtn:""===inputError&&0!==rating&&reviewText.length>=10})]})})]})})]})};ReviewsForm_ReviewsForm.defaultProps={onSubmit:function onSubmit(){},serverError:void 0},ReviewsForm_ReviewsForm.__docgenInfo={description:"",methods:[],displayName:"ReviewsForm",props:{onSubmit:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1},serverError:{defaultValue:{value:"undefined",computed:!0},description:"",type:{name:"string"},required:!1}}};var Forms_ReviewsForm_ReviewsForm=ReviewsForm_ReviewsForm},"./src/components/UI-kit/StarRating/StarRating.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _home_runner_work_book_it_coworking_frontend_book_it_coworking_frontend_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js"),StarRating=function StarRating(_ref){var rating=_ref.rating,onRatingChange=_ref.onRatingChange,_React$useState=react__WEBPACK_IMPORTED_MODULE_0__.useState(0),_React$useState2=(0,_home_runner_work_book_it_coworking_frontend_book_it_coworking_frontend_node_modules_babel_runtime_helpers_esm_slicedToArray_js__WEBPACK_IMPORTED_MODULE_2__.Z)(_React$useState,2),hoverRating=_React$useState2[0],setHoverRating=_React$useState2[1],handleStarClick=react__WEBPACK_IMPORTED_MODULE_0__.useCallback((function(star){onRatingChange(star)}),[onRatingChange]),handleStarHover=function handleStarHover(star){setHoverRating(star)},renderStars=react__WEBPACK_IMPORTED_MODULE_0__.useMemo((function(){for(var stars=[],_loop=function _loop(i){stars.push((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("button",{className:"button button_type_review ".concat(i<=(hoverRating||rating)?"filled":""),onClick:function onClick(){return handleStarClick(i)},onMouseEnter:function onMouseEnter(){return handleStarHover(i)},onMouseLeave:function onMouseLeave(){return handleStarHover(0)},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:i<=(hoverRating||rating)?"#ffea30":"none",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",stroke:i<=(hoverRating||rating)?"#ffea30":"#122023",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},i))},i=1;i<=5;i+=1)_loop(i);return stars}),[rating,hoverRating,handleStarClick]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{children:renderStars})};StarRating.defaultProps={rating:0,onRatingChange:function onRatingChange(){}},StarRating.__docgenInfo={description:"",methods:[],displayName:"StarRating",props:{rating:{defaultValue:{value:"0",computed:!1},description:"",type:{name:"number"},required:!1},onRatingChange:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1}}},__webpack_exports__.Z=react__WEBPACK_IMPORTED_MODULE_0__.memo(StarRating)},"./src/images/dummy-spot2.jpg":function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"04ff475c35a85ed7a793.jpg"}}]);